<!DOCTYPE html>
<html>
<head>
  <title>Content Encryption Tool v21</title>
  <style>
    body { font-family: sans-serif; }
    #encryptionTool { max-width: 600px; margin: 0 auto; padding: 20px; }
    textarea, input { width: 100%; height: 150px; margin-bottom: 10px; white-space: pre-wrap; resize: vertical; box-sizing: border-box; } 
    button { padding: 8px 15px; }
    #statusMessage { margin-top: 10px; }
  </style>
</head>
<body>
  <div id="encryptionTool">
    <h2>Content Encryption Tool v21</h2>

    <label for="keyInput">Encryption Key:</label>
    <input type="text" id="keyInput" value="">

    <label for="keyHashOutput">SHA-256 Hash of Key:</label>
    <textarea id="keyHashOutput" readonly></textarea>

    <label for="contentInput">Content to Encrypt (Paste your SPA HTML here):</label>
    <textarea id="contentInput"></textarea>

    <label for="encryptedOutput">Encrypted Content:</label>
    <textarea id="encryptedOutput" readonly></textarea>

    <label for="decryptedOutput">Decrypted Content (for verification):</label>
    <textarea id="decryptedOutput" readonly></textarea>

    <p id="statusMessage"></p>
  </div>

  <script>
    document.title = document.title.replace(/\d+$/, match => ++match); 
    (async (keyInput, contentInput, encryptedOutput, decryptedOutput, keyHashDisplay, statusMessage, encoder = new TextEncoder()) => {
        async function displayKeyHash(key) { if (key.trim() !== '') { const hashedKey = await encryptInput(key); keyHashDisplay.textContent = hashedKey; } }
        async function encryptInput(input) { const data = encoder.encode(input); const hashBuffer = await crypto.subtle.digest('SHA-256', data); return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join(''); }
        async function encryptContent(content, key) { const data = encoder.encode(content), iv = crypto.getRandomValues(new Uint8Array(12)), keyMaterial = await crypto.subtle.importKey("raw", encoder.encode(key), { name: "PBKDF2" }, false, ["deriveKey"]), derivedKey = await crypto.subtle.deriveKey({ name: "PBKDF2", salt: new Uint8Array(), iterations: 100000, hash: "SHA-256" }, keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]), encrypted = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, derivedKey, data); const encryptedData = new Uint8Array(encrypted), combined = new Uint8Array(iv.length + encryptedData.length); combined.set(iv); combined.set(encryptedData, iv.length); return btoa(String.fromCharCode.apply(null, combined)); }
        async function decryptContent(encryptedContent, key) { const keyData = encoder.encode(key), combined = new Uint8Array(atob(encryptedContent).split('').map(char => char.charCodeAt(0))), iv = combined.slice(0, 12), ciphertext = combined.slice(12), keyMaterial = await crypto.subtle.importKey("raw", encoder.encode(key), { name: "PBKDF2" }, false, ["deriveKey"]), derivedKey = await crypto.subtle.deriveKey({ name: "PBKDF2", salt: new Uint8Array(), iterations: 100000, hash: "SHA-256" }, keyMaterial, { name: "AES-GCM", length: 256 }, false, ["encrypt", "decrypt"]), decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, derivedKey, ciphertext); return new TextDecoder().decode(decrypted); }
        function updateEncryptedContent() { const content = contentInput.value, key = keyInput.value; if (key.trim() === '') { statusMessage.textContent = "Please enter an encryption key."; return; } displayKeyHash(); encryptContent(content, key).then(async (encrypted) => { encryptedOutput.value = encrypted; try { const decrypted = await decryptContent(encrypted, keyInput.value); decryptedOutput.value = decrypted; statusMessage.textContent = "Encryption/Decryption successful!"; } catch (error) { console.error('Decryption error:', error); statusMessage.textContent = "Error: Decryption failed."; } }).catch(error => { console.error('Encryption error:', error); outputContent.value = "Error encrypting content"; }); }
        keyInput.addEventListener('input', updateEncryptedContent); contentInput.addEventListener('input', updateEncryptedContent); encryptedOutput.addEventListener('click', () => { encryptedOutput.select(); document.execCommand('copy'); }); setTimeout(updateEncryptedContent, 500); 
    })(
      document.getElementById('keyInput'),
      document.getElementById('contentInput'),
      document.getElementById('encryptedOutput'),
      document.getElementById('decryptedOutput'),
      document.getElementById('keyHash'),
      document.getElementById('statusMessage')
    );
  </script>
</body>
</html>
